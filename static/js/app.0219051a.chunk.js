(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{194:function(e,t,n){e.exports=n(325)},235:function(e,t){},237:function(e,t){},325:function(t,n,a){"use strict";a.r(n);a(324);var o=a(329),r=a(77),s=a.n(r),i=a(193),l=a(0),c=a.n(l),u=a(5),d=a(43),p=a(3),f=a(34),m=a(107),h=a(27),y=a(137),v=a(192),g=a.n(v),b={SystemLog:{display:"Last Log"},resetReason:{display:"Reset Reason"},espFwRevision:{display:"ESP Firmware Version"},TiFwRevision:{display:"MSP Firmware Version"},wifiRxSignaldB:{display:"Wifi Signal"},heartBeat:{display:"Last Heartbeat"},dropboxId:{display:"Dropbox Instance"},serviceMode:{display:"Service Mode Flag"},timeZone:{display:"Timezone"},maxTmrBackoff:{display:"Max TMR Backoff"}},S={siteName:{display:"Site Name"},installLocation:{display:"Install Location"},waterSource:{display:"Municipal"},siteNotes:{display:"Site Notes"},pipeType:{display:"Pipe Type"}},F={transmitFrequency:{display:"Frequency"},numOfExcitationPulses:{display:"Pulse Count"},gainControl:{display:"Gain"},envelopeCrossingThreshold:{display:"Envelope Threshold"},startADCsamplingCount:{display:"Start ADC Count"},sampleSize:{display:"Window Size"},"3V3TxVoltage":{display:"3V3 TX Voltage"},attenEnabled:{display:"Attenuation"},pipeType:{display:"Pipe Type"}},w=a(10),E=a.n(w),C=a(11),T=a.n(C),P={},k=function(){function t(e){E()(this,t),this.id=e,this.status=null,this.events=[],this.system={},this.metadata={},this.params={}}return T()(t,[{key:"updateSystemProp",value:function(e,t){null!=b[e]&&(this.system[e]=t)}},{key:"updateMetadataProp",value:function(e,t){null!=S[e]&&(this.metadata[e]=t)}},{key:"updateParamProp",value:function(e,t){null!=F[e]&&(this.params[e]=t)}},{key:"updateEventProp",value:function(t,n){var a=t.join(".");this.events.push({type:a,data:n});var o=null;try{if(null==(o=JSON.parse(n)))return void console.log("Failed to parse event msg as json: ",n,e.message)}catch(e){return void console.log("Failed to parse event msg as json: ",n,e.message)}"status"==a&&(null!=o.status?this.status=o.status:null!=o["esp version"]?this.system.espFwRevision=o["esp version"]:null!=o["TI version"]&&(this.system.TiFwRevision=o["TI version"]))}},{key:"updateFromRx",value:function(e,t){var n=e.split("/"),a=n[3];"system"==a?this.updateSystemProp(n[4],t):"metadata"==a?this.updateMetadataProp(n[4],t):"params"==a?this.updateParamProp(n[4],t):"events"==a&&this.updateEventProp(n.slice(4),t)}},{key:"toString",value:function(){var e=["----------------------------------------"];for(var t in e.push(this.id),e.push("----------------------------------------"),e.push("Status: "+this.status),e.push("----System Properties----"),this.system)e.push(t+": "+this.system[t]);for(var n in e.push("----Metadata----"),this.metadata)e.push(n+": "+this.metadata[n]);for(var a in e.push("----Sensor Parameters----"),this.params)e.push(a+": "+this.params[a]);return e.join("\n")}}],[{key:"extractDeviceString",value:function(e){var t=e.split("/");if(t.length<=3)return null;var n=t[2];return n.startsWith("AW")&&6==n.length?n:null}},{key:"getDeviceForTopic",value:function(e){var n=t.extractDeviceString(e);return n?(null!=P[n]||(P[n]=new t(n)),P[n]):null}},{key:"getDevices",value:function(){return P}}]),t}(),R=g.a.connect("wss://dizzofac:Qbz5ly_pY0MS@stellar-lifeguard.cloudmqtt.com:443"),x=null,D=[];R.on("message",(function(e,t){var n=k.getDeviceForTopic(e);if(null==n)return;n.updateFromRx(e,t.toString()),clearTimeout(x),x=setTimeout(M,200)}));function M(){var e=k.getDevices();console.log("Notifying!");for(var t=0;t<D.length;t++)D[t](e)}function A(e){D.push(e)}R.on("reconnect",(function(e,t){console.debug("on reconnect")})),R.on("close",(function(e,t){console.debug("on close")})),R.on("disconnect",(function(e,t){console.debug("on disconnect")})),R.on("offline",(function(e,t){console.debug("on offline")})),R.on("error",(function(e,t){console.debug("on error")})),R.on("end",(function(e,t){console.debug("on end")})),R.on("connect",(function(e,t){console.log("connected to MQTT broker"),R.subscribe("/AWACS_ADC_vAf5hLnp6J/#",(function(e){e?(console.warn("Failed to subscribe"),alert("ERROR: Unable to reach MQTT Server: ",e)):console.debug("Subscribe successful")}))}));var O=h.a.get("window").width,j={backgroundGradientFrom:"#eff3ff",backgroundGradientTo:"#efefef",decimalPlaces:0,color:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return"rgba(80, 80, 80, "+e+")"},strokeWidth:0,barPercentage:.8,useShadowColorFromDataset:!1},W=function(){return O>400?O/3:O/1.5};function z(){var e=Object(l.useState)([]),t=s()(e,2),n=t[0],a=t[1],o=Object(l.useState)([]),r=s()(o,2),i=r[0],u=r[1],f=function(e){var t=[],n=[];for(var o in e)99!=e[o].status?t.push(o):n.push(o);a(t),u(n)};Object(l.useEffect)((function(){A(f)}),[]);var m={labels:["Connected","Disconnected"],datasets:[{data:[n.length,i.length],colors:[function(){return"green"},function(){return"red"}]}]};return c.a.createElement(p.a,{style:V.chartWrap},c.a.createElement(d.a,{style:V.header},"Connection Status"),c.a.createElement(y.a,{style:{marginVertical:8,borderRadius:16},data:m,width:W(),height:200,chartConfig:j,yAxisInterval:10,segments:3,yLabelsOffset:35,withCustomBarColorFromData:!0,flatColor:!0,fromZero:!0,withInnerLines:!0,showValuesOnTopOfBars:!0}))}function L(e){var t=Object(l.useState)([]),n=s()(t,2),a=n[0],o=n[1],r="",i="";"ESP"==e.processor?(r="espFwRevision",i="ESP32 Firmware"):(r="TiFwRevision",i="MSP430 Firmware");var u=function(e){var t={};for(var n in e){var a=e[n].system[r];null==t[a=a?"  v"+a:"  Unknown"]?t[a]=1:t[a]+=1}var s=["gray","red","blue","green","yellow","cyan"],i=Object.keys(t).map((function(e,n){return{name:e,count:t[e],color:s[n],legendFontColor:"#7F7F7F",legendFontSize:15}}));o(i)};return Object(l.useEffect)((function(){A(u)}),[]),c.a.createElement(p.a,{style:[V.chartContainer]},c.a.createElement(d.a,{style:V.header},i),c.a.createElement(p.a,{style:[V.chartWrap,{backgroundColor:"#eff3ff"}]},c.a.createElement(y.b,{accessor:"count",data:a,width:W(),height:150,chartConfig:j,backgroundColor:"#FFFFFF00",withCustomBarColorFromData:!0,flatColor:!0,absolute:!0})))}function B(e){return O>400?c.a.createElement(p.a,{style:{flexDirection:"row"}},e.children):e.children}function I(){return c.a.createElement(p.a,{style:{flex:1,margin:8,alignItems:"center"}},c.a.createElement(z,null),c.a.createElement(B,null,c.a.createElement(L,{processor:"ESP"}),c.a.createElement(L,{processor:"MSP"})))}var V=u.a.create({container:{flex:1,backgroundColor:"white"},chartContainer:{marginHorizontal:25,marginBottom:25},chartWrap:{padding:10,borderRadius:20},header:{textAlign:"center",fontSize:18,padding:16}});Object(o.a)((function(){return c.a.createElement(m.a,{style:V.container},c.a.createElement(d.a,null,"Demo AWACS Admin"),c.a.createElement(i.a,{style:"auto"}),c.a.createElement(f.a,null,c.a.createElement(I,null)))}))}},[[194,1,2]]]);
//# sourceMappingURL=app.0219051a.chunk.js.map